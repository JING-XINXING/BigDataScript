#!/usr/bin/env bds

# 
# Get AWS S3 parameters from $HOME/.bds/aws_test_bucket.txt
# File format is 2 lines:
#	line 1: Region
#   line 2: Bucket name
#

string[] getAwsInfo() {
	awsBucketFile := 'aws_test_bucket.txt'
	bdsHomeDir := getVar('BDS_HOME', "$HOME/.bds")
	file := "$bdsHomeDir/$awsBucketFile"
	if( ! file.exists() ) error "Cannot file AWS bucket test information file '$file'"
	return file.readLines()
}

string getAwsBucketName() return getAwsInfo()[1].trim()

string getAwsRegion() return getAwsInfo()[0].trim()

awsRegion := getAwsRegion()
bucket := getAwsBucketName()
test := programName.removeExt()
s3base := "s3://$bucket/tmp/bds/$test"
tmpDir := getVar('TMPDIR', '/tmp')

# Create a file in S3 if it doesn't exist
void createS3(string s3file) {
	createS3(s3file, 'OK')
}

void createS3(string s3file, string text) {
	if( s3file.exists() ) {
		println "CreateS3: OK, file '$s3file' exists, nothing done"
	} else {
		println "CreateS3: Uploading file '$s3file'"
		s3file.write(text)
	}
}
